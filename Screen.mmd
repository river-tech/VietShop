graph TD
    %% --- STYLES (UPDATED TEXT COLOR TO BLACK) ---
    classDef customer fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px,color:#000000;
    classDef seller fill:#fff3e0,stroke:#f9a825,stroke-width:2px,color:#000000;
    classDef shipper fill:#e1f5fe,stroke:#0277bd,stroke-width:2px,color:#000000;
    classDef admin fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000000;
    classDef common fill:#ffffff,stroke:#333,stroke-width:1px,stroke-dasharray: 5 5,color:#000000;
    classDef newScreen fill:#ffcdd2,stroke:#d32f2f,stroke-width:4px,color:#000000; 

    %% ==========================================================
    %% APP 1: CLIENT SUPER APP (CUSTOMER & SELLER)
    %% ==========================================================
    subgraph APP_CLIENT [ðŸ“± APP 1: CLIENT SUPER APP]
        direction TB

        %% --- SHARED AUTH ---
        subgraph AUTH [Authentication]
            CUS_SCR_001(CUS_SCR_001: Onboarding) --> CUS_SCR_002(CUS_SCR_002: Login)
            CUS_SCR_002 --> CUS_SCR_003(CUS_SCR_003: Register)
            CUS_SCR_002 --> CUS_SCR_004(CUS_SCR_004: Forgot Password)
        end

        %% --- CUSTOMER ROLE ---
        subgraph ROLE_CUSTOMER [ðŸ‘¤ Role: Customer]
            direction TB
            
            %% Main Navigation
            CUS_SCR_002 --> CUS_SCR_005(CUS_SCR_005: Home Page):::customer
            
            %% Discovery Flow
            CUS_SCR_005 --> CUS_SCR_029(CUS_SCR_029: Search):::customer
            CUS_SCR_005 --> CUS_SCR_006(CUS_SCR_006: Product List):::customer
            CUS_SCR_006 --> CUS_SCR_007(CUS_SCR_007: Product Details):::customer
            CUS_SCR_007 --> CUS_SCR_036(CUS_SCR_036: Reviews):::customer
            CUS_SCR_007 --> CUS_SCR_041(CUS_SCR_041: Shop Page):::customer

            %% Shopping & Checkout Flow (UPDATED)
            CUS_SCR_007 -- Add to Cart --> CUS_SCR_008(CUS_SCR_008: Cart):::customer
            CUS_SCR_008 --> CUS_SCR_009(CUS_SCR_009: Checkout Info):::customer
            CUS_SCR_009 -- Input Address/Voucher --> CUS_SCR_009B(CUS_SCR_009B: Confirm Order):::newScreen
            CUS_SCR_009B -- Final Review --> CUS_SCR_045(CUS_SCR_045: Order Result):::customer
            
            %% Order Management
            CUS_SCR_045 --> CUS_SCR_030(CUS_SCR_030: Order History):::customer
            CUS_SCR_030 --> CUS_SCR_031(CUS_SCR_031: Order Details):::customer
            CUS_SCR_031 --> CUS_SCR_037(CUS_SCR_037: Write Review):::customer

            %% Ecosystem (Wallet & Game)
            CUS_SCR_005 --> CUS_SCR_012(CUS_SCR_012: Wallet Overview):::customer
            CUS_SCR_012 --> CUS_SCR_013(CUS_SCR_013: Deposit Wallet):::customer
            CUS_SCR_012 --> CUS_SCR_014(CUS_SCR_014: Withdraw Wallet):::customer
            CUS_SCR_012 --> CUS_SCR_015(CUS_SCR_015: Wallet History):::customer
            CUS_SCR_005 --> CUS_SCR_016(CUS_SCR_016: Mini Game List):::customer
            CUS_SCR_016 --> CUS_SCR_019(CUS_SCR_019: Water Tree):::customer
            CUS_SCR_005 --> CUS_SCR_020(CUS_SCR_020: Livestream List):::customer
            CUS_SCR_020 --> CUS_SCR_021(CUS_SCR_021: Livestream Room):::customer
            
            %% Personal
            CUS_SCR_005 --> CUS_SCR_032(CUS_SCR_032: Profile):::customer
            CUS_SCR_032 --> CUS_SCR_034(CUS_SCR_034: Settings):::customer
            CUS_SCR_032 --> CUS_SCR_028(CUS_SCR_028: Notifications):::customer

            %% ==========================================================
            %% CUSTOMER MODULES VIEW (Profile / Mini Game / Product / Wallet / Order)
            %% (Only adding groupings & cross-module flows, existing nodes/edges kept)
            %% ==========================================================

            %% --- PRODUCT MODULE ---
            subgraph MOD_PRODUCT [ðŸ›’ Module: Product & Discovery]
                direction TB
                CUS_SCR_005
                CUS_SCR_029
                CUS_SCR_006
                CUS_SCR_007
                CUS_SCR_036
                CUS_SCR_041
            end

            %% --- ORDER MODULE ---
            subgraph MOD_ORDER [ðŸ“¦ Module: Order]
                direction TB
                CUS_SCR_008
                CUS_SCR_009
                CUS_SCR_009B
                CUS_SCR_045
                CUS_SCR_030
                CUS_SCR_031
                CUS_SCR_037
            end

            %% --- WALLET MODULE ---
            subgraph MOD_WALLET [ðŸ’° Module: Wallet]
                direction TB
                CUS_SCR_012
                CUS_SCR_013
                CUS_SCR_014
                CUS_SCR_015
            end

            %% --- MINI GAME MODULE ---
            subgraph MOD_MINIGAME [ðŸŽ® Module: Mini Game]
                direction TB
                CUS_SCR_016
                CUS_SCR_019
            end

            %% --- LIVE STREAM MODULE ---
            subgraph MOD_LIVE [ðŸ“º Module: Live Stream]
                direction TB
                CUS_SCR_020
                CUS_SCR_021
            end

            %% --- PROFILE MODULE ---
            subgraph MOD_PROFILE [ðŸ™â€â™‚ï¸ Module: Profile]
                direction TB
                CUS_SCR_032
                CUS_SCR_034
                CUS_SCR_028
            end

            %% --- CROSS-MODULE REDIRECTION FLOWS ---

            %% Product â†’ Order
            CUS_SCR_007 -.->|Add to Cart & Checkout| CUS_SCR_008
            CUS_SCR_009B -.->|Order Created| CUS_SCR_045
            CUS_SCR_045 -.->|View Order History| CUS_SCR_030

            %% Order â†’ Product
            CUS_SCR_031 -.->|Buy Again| CUS_SCR_007

            %% Product â†’ Wallet
            CUS_SCR_009 -.->|Select Wallet Payment| CUS_SCR_012

            %% Wallet â†’ Order / Product
            CUS_SCR_012 -.->|Back to Checkout Confirm| CUS_SCR_009B
            CUS_SCR_012 -.->|View Order History| CUS_SCR_030
            CUS_SCR_012 -.->|Top-up Wallet| CUS_SCR_013
            CUS_SCR_012 -.->|Withdraw to Bank| CUS_SCR_014
            CUS_SCR_013 -.->|View Wallet History| CUS_SCR_015
            CUS_SCR_014 -.->|View Wallet History| CUS_SCR_015

            %% Checkout â†’ Wallet Top-up
            CUS_SCR_009B -.->|Insufficient balance? Top-up| CUS_SCR_013

            %% Mini Game â†’ Product / Wallet
            CUS_SCR_019 -.->|Redeem Voucher on Product| CUS_SCR_007
            CUS_SCR_019 -.->|Receive Coins in Wallet| CUS_SCR_012

            %% Live Stream â†’ Product / Order
            CUS_SCR_021 -.->|View Product from Live| CUS_SCR_007
            CUS_SCR_021 -.->|Add to Cart from Live| CUS_SCR_008

            %% Profile â†’ Other Modules
            CUS_SCR_032 -.->|Go to Wallet| CUS_SCR_012
            CUS_SCR_032 -.->|Go to Order History| CUS_SCR_030
            CUS_SCR_032 -.->|Go to Mini Game| CUS_SCR_016
            CUS_SCR_032 -.->|View Notifications| CUS_SCR_028

            %% Global return paths to Home
            CUS_SCR_030 -.->|Back to Home| CUS_SCR_005
            CUS_SCR_012 -.->|Back to Home| CUS_SCR_005
            CUS_SCR_016 -.->|Back to Home| CUS_SCR_005
            CUS_SCR_020 -.->|Back to Home| CUS_SCR_005
            CUS_SCR_021 -.->|Back to Home| CUS_SCR_005
        end

        %% --- SELLER ROLE ---
        subgraph ROLE_SELLER [ðŸª Role: Seller]
            direction TB
            
            %% Switch Role
            CUS_SCR_032 -.->|Switch to Seller Channel| SEL_SCR_001(SEL_SCR_001: Seller Login/Auth):::seller
            SEL_SCR_001 --> SEL_SCR_002(SEL_SCR_002: Seller Dashboard):::seller

            %% Seller Modules
            SEL_SCR_002 --> SEL_PROD[Product Mgmt]:::seller
            SEL_PROD --> SEL_SCR_003(SEL_SCR_003: Product List):::seller
            SEL_SCR_003 --> SEL_SCR_004(SEL_SCR_004: Create Product):::seller
            
            SEL_SCR_002 --> SEL_ORDER[Order Mgmt]:::seller
            SEL_ORDER --> SEL_SCR_009(SEL_SCR_009: Order List):::seller
            SEL_SCR_009 --> SEL_SCR_010(SEL_SCR_010: Order Detail):::seller
            SEL_SCR_010 --> SEL_SCR_011(SEL_SCR_011: Process Order):::seller

            SEL_SCR_002 --> SEL_LIVE[Livestream]:::seller
            SEL_LIVE --> SEL_SCR_016(SEL_SCR_016: Create Live):::seller
            
            %% New Seller Features
            SEL_SCR_002 --> SEL_REFUND[Return/Refund]:::newScreen
            SEL_REFUND --> SEL_SCR_026(SEL_SCR_026: Return List):::newScreen
            SEL_SCR_026 --> SEL_SCR_027(SEL_SCR_027: Return Details):::newScreen
            
            SEL_SCR_002 --> SEL_NOTI[Notifications]:::newScreen
            SEL_NOTI --> SEL_SCR_028(SEL_SCR_028: Noti Center):::newScreen
            SEL_SCR_028 --> SEL_SCR_029(SEL_SCR_029: Noti Settings):::newScreen

            %% ==========================================================
            %% SELLER MODULES VIEW (Product / Order / Livestream / Notifications)
            %% ==========================================================

            %% --- SELLER PRODUCT MODULE ---
            subgraph MOD_SELLER_PRODUCT [ðŸª Seller Module: Product]
                direction TB
                SEL_PROD
                SEL_SCR_003
                SEL_SCR_004
            end

            %% --- SELLER ORDER MODULE ---
            subgraph MOD_SELLER_ORDER [ðŸ“¦ Seller Module: Order]
                direction TB
                SEL_ORDER
                SEL_SCR_009
                SEL_SCR_010
                SEL_SCR_011
            end

            %% --- SELLER LIVESTREAM MODULE ---
            subgraph MOD_SELLER_LIVE [ðŸ“º Seller Module: Livestream]
                direction TB
                SEL_LIVE
                SEL_SCR_016
            end

            %% --- SELLER NOTIFICATION MODULE ---
            subgraph MOD_SELLER_NOTI [ðŸ”” Seller Module: Notifications]
                direction TB
                SEL_NOTI
                SEL_SCR_028
                SEL_SCR_029
            end

            %% --- SELLER CROSS-MODULE FLOWS ---

            %% Product â†’ Order
            SEL_SCR_003 -.->|Check orders for product| SEL_SCR_009
            SEL_SCR_004 -.->|View related orders| SEL_SCR_009

            %% Order â†’ Refund
            SEL_SCR_010 -.->|Create/Manage return| SEL_SCR_026
            SEL_SCR_026 -.->|View order details| SEL_SCR_010

            %% Livestream â†’ Product / Order
            SEL_SCR_016 -.->|Manage products in live| SEL_SCR_003
            SEL_SCR_016 -.->|Track live orders| SEL_SCR_009

            %% Notifications â†’ Product / Order
            SEL_SCR_028 -.->|Order-related notifications| SEL_SCR_009
            SEL_SCR_028 -.->|Product-related notifications| SEL_SCR_003
        end
    end

    %% ==========================================================
    %% APP 2: PARTNER APP (SHIPPER) - REMOVED
    %% Shipping is handled by external providers; no internal Shipper app.
    %% All SHP_SCR_* screens are out of scope and removed from this diagram.
    %% ==========================================================

    %% ==========================================================
    %% WEB ADMIN PORTAL
    %% ==========================================================
    subgraph WEB_ADMIN [ðŸ’» WEB ADMIN PORTAL]
        direction TB
        ADM_SCR_001(ADM_SCR_001: Admin Login):::admin --> ADM_SCR_002(ADM_SCR_002: Dashboard):::admin
        
        ADM_SCR_002 --> ADM_GRP_USER[User & Seller Mgmt]:::admin
        ADM_GRP_USER --> ADM_SCR_003(User Mgmt):::admin
        ADM_GRP_USER --> ADM_SCR_004(Seller Mgmt):::admin

        ADM_SCR_002 --> ADM_GRP_PROD[Product & Order]:::admin
        ADM_GRP_PROD --> ADM_SCR_005(Product Approval):::admin
        ADM_GRP_PROD --> ADM_SCR_007(Order Mgmt):::admin
        
        ADM_SCR_002 --> ADM_GRP_SYS[System & CMS]:::admin
        ADM_GRP_SYS --> ADM_SCR_020(Banner CMS):::admin
        ADM_GRP_SYS --> ADM_SCR_011(Wallet Mgmt):::admin
    end

    %% --- EXTERNAL SHIPPING PROVIDER (OUT OF SCOPE) ---
    EXT_SHIP["External Shipping Provider - Out of scope"]:::common

    %% --- CROSS CONNECTIONS ---
    CUS_SCR_009B -.->|Create Order| SEL_SCR_009
    SEL_SCR_011 -.->|Hand over shipment| EXT_SHIP
    EXT_SHIP -.->|Delivery status update| CUS_SCR_031