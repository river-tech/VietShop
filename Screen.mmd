graph TD
    %% --- STYLES (UPDATED TEXT COLOR TO BLACK) ---
    classDef customer fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px,color:#000000;
    classDef seller fill:#fff3e0,stroke:#f9a825,stroke-width:2px,color:#000000;
    classDef admin fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000000;
    classDef common fill:#ffffff,stroke:#333,stroke-width:1px,stroke-dasharray: 5 5,color:#000000;
    classDef newScreen fill:#ffcdd2,stroke:#d32f2f,stroke-width:4px,color:#000000; 

    %% ==========================================================
    %% APP 1: CLIENT SUPER APP (CUSTOMER & SELLER)
    %% ==========================================================
    subgraph APP_CLIENT [APP 1: CLIENT SUPER APP]
        direction TB

        %% --- SHARED AUTH ---
        subgraph AUTH [Authentication]
            CUS_SCR_001(CUS_SCR_001: Onboarding) --> CUS_SCR_002(CUS_SCR_002: Login):::customer
            CUS_SCR_002 --> CUS_SCR_003(CUS_SCR_003: Register):::customer
            CUS_SCR_002 --> CUS_SCR_004(CUS_SCR_004: Forgot Password):::customer
            CUS_SCR_002 --> CUS_SCR_010(CUS_SCR_010: Auth Verification):::customer
        end

        %% --- CUSTOMER ROLE ---
        subgraph ROLE_CUSTOMER [Role: Customer]
            direction TB
            
            %% Entry after login
            CUS_SCR_002 --> CUS_ENTRY[Customer Entry]:::customer

            %% ===========================
            %% PRODUCT & CATEGORY
            %% ===========================
            subgraph CUS_MOD_PRODUCT [Customer: Product & Category]
                direction TB
                CUS_SCR_053(CUS_SCR_053: Category Home):::customer
                CUS_SCR_054(CUS_SCR_054: Subcategory Listing):::customer
                CUS_SCR_055(CUS_SCR_055: Category Filter & Sort):::customer
                CUS_SCR_007(CUS_SCR_007: Product Details):::customer
                CUS_SCR_041(CUS_SCR_041: Shop Page):::customer
                CUS_SCR_035(CUS_SCR_035: Wishlist):::customer
            end

            CUS_ENTRY --> CUS_SCR_053
            CUS_SCR_053 --> CUS_SCR_054
            CUS_SCR_054 --> CUS_SCR_055
            CUS_SCR_054 --> CUS_SCR_007
            CUS_SCR_007 --> CUS_SCR_041
            CUS_SCR_007 -.->|Add/Remove from Wishlist| CUS_SCR_035

            %% ===========================
            %% ORDER / CHECKOUT / RETURN
            %% ===========================
            subgraph CUS_MOD_ORDER [Customer: Order & Return]
                direction TB
                CUS_SCR_008(CUS_SCR_008: Cart):::customer
                CUS_SCR_009(CUS_SCR_009: Checkout):::customer
                CUS_SCR_045(CUS_SCR_045: Order Result):::customer
                CUS_SCR_030(CUS_SCR_030: Order History):::customer
                CUS_SCR_031(CUS_SCR_031: Order Details):::customer
                CUS_SCR_046(CUS_SCR_046: Return/Refund Request):::customer
            end

            CUS_SCR_007 -- Add to Cart --> CUS_SCR_008
            CUS_SCR_008 --> CUS_SCR_009
            CUS_SCR_009 --> CUS_SCR_045
            CUS_SCR_045 --> CUS_SCR_030
            CUS_SCR_030 --> CUS_SCR_031
            CUS_SCR_031 --> CUS_SCR_046
            

            %% ===========================
            %% REVIEW
            %% ===========================
            subgraph CUS_MOD_REVIEW [Customer: Review]
                direction TB
                CUS_SCR_037(CUS_SCR_037: Write Review):::customer
                CUS_SCR_039(CUS_SCR_039: Edit Review):::customer
                CUS_SCR_040(CUS_SCR_040: Review List):::customer
            end

            CUS_SCR_031 --> CUS_SCR_037
            CUS_SCR_037 --> CUS_SCR_040
            CUS_SCR_037 -.-> CUS_SCR_039

            %% ===========================
            %% WALLET
            %% ===========================
            subgraph CUS_MOD_WALLET [Customer: Wallet]
                direction TB
                CUS_SCR_012(CUS_SCR_012: Wallet Overview):::customer
                CUS_SCR_013(CUS_SCR_013: Deposit Wallet):::customer
                CUS_SCR_014(CUS_SCR_014: Withdraw Wallet):::customer
                CUS_SCR_015(CUS_SCR_015: Wallet History):::customer
                CUS_SCR_048(CUS_SCR_048: Wallet Promotions):::customer
                CUS_SCR_050(CUS_SCR_050: Top-up Methods):::customer
                CUS_SCR_051(CUS_SCR_051: Linked Bank Accounts):::customer
                CUS_SCR_052(CUS_SCR_052: Wallet Settings):::customer
            end

            CUS_ENTRY --> CUS_SCR_012
            CUS_SCR_012 --> CUS_SCR_013
            CUS_SCR_012 --> CUS_SCR_014
            CUS_SCR_012 --> CUS_SCR_015
            CUS_SCR_012 --> CUS_SCR_048
            CUS_SCR_012 --> CUS_SCR_050
            CUS_SCR_012 --> CUS_SCR_051
            CUS_SCR_012 --> CUS_SCR_052
            CUS_SCR_013 -.-> CUS_SCR_015
            CUS_SCR_014 -.-> CUS_SCR_015
            CUS_SCR_009 -.->|Select Wallet Payment| CUS_SCR_012

            %% ===========================
            %% CHAT
            %% ===========================
            subgraph CUS_MOD_CHAT [Customer: Chat]
                direction TB
                CUS_SCR_056(CUS_SCR_056: Chat List):::customer
                CUS_SCR_057(CUS_SCR_057: Chat Detail):::customer
                CUS_SCR_058(CUS_SCR_058: Chat from Product):::customer
            end

            CUS_ENTRY --> CUS_SCR_056
            CUS_SCR_056 --> CUS_SCR_057
            CUS_SCR_007 -.-> CUS_SCR_058

            %% ===========================
            %% NOTIFICATION
            %% ===========================
            subgraph CUS_MOD_NOTI [Customer: Notification]
                direction TB
                CUS_SCR_059(CUS_SCR_059: Notification Center):::customer
                CUS_SCR_060(CUS_SCR_060: Notification Detail):::customer
                CUS_SCR_061(CUS_SCR_061: Notification Settings):::customer
            end

            CUS_ENTRY --> CUS_SCR_059
            CUS_SCR_059 --> CUS_SCR_060
            CUS_SCR_059 --> CUS_SCR_061

            %% ===========================
            %% PROFILE
            %% ===========================
            subgraph CUS_MOD_PROFILE [Customer: Profile]
                direction TB
                CUS_SCR_062(CUS_SCR_062: Profile Overview):::customer
                CUS_SCR_063(CUS_SCR_063: Edit Profile):::customer
                CUS_SCR_064(CUS_SCR_064: Address Management):::customer
                CUS_SCR_065(CUS_SCR_065: Security Settings):::customer
                CUS_SCR_066(CUS_SCR_066: Preferences):::customer
            end

            CUS_ENTRY --> CUS_SCR_062
            CUS_SCR_062 --> CUS_SCR_063
            CUS_SCR_062 --> CUS_SCR_064
            CUS_SCR_062 --> CUS_SCR_065
            CUS_SCR_062 --> CUS_SCR_066

            %% Profile shortcuts to key modules
            CUS_SCR_062 -.->|Go to Wallet| CUS_SCR_012
            CUS_SCR_062 -.->|Go to Order History| CUS_SCR_030
            CUS_SCR_062 -.->|View Notifications| CUS_SCR_059
        end

        %% --- SELLER ROLE ---
        subgraph ROLE_SELLER [Role: Seller]
            direction TB
            
            %% Switch Role / Entry
            CUS_SCR_062 -.->|Switch to Seller Channel| SEL_ENTRY[Seller Entry]:::seller

            %% ===========================
            %% SELLER PRODUCT & INVENTORY
            %% ===========================
            subgraph SEL_MOD_PRODUCT [Seller: Product & Inventory]
                direction TB
                SEL_SCR_007_INVENTORY(SEL_SCR_007: Inventory Management):::seller
                SEL_SCR_030_ADD_BASIC(SEL_SCR_030: Add Product - Basic Info):::seller
                SEL_SCR_031_ADD_SALES(SEL_SCR_031: Add Product - Sales Info):::seller
                SEL_SCR_032_EDIT_PRODUCT(SEL_SCR_032: Edit Product):::seller
                SEL_SCR_023_VOUCHER(SEL_SCR_023: Voucher Management):::seller
                SEL_SCR_025_REVIEW(SEL_SCR_025: Product Review Management):::seller
            end

            SEL_ENTRY --> SEL_SCR_007_INVENTORY
            SEL_SCR_007_INVENTORY --> SEL_SCR_030_ADD_BASIC
            SEL_SCR_030_ADD_BASIC --> SEL_SCR_031_ADD_SALES
            SEL_SCR_031_ADD_SALES --> SEL_SCR_007_INVENTORY
            SEL_SCR_007_INVENTORY --> SEL_SCR_032_EDIT_PRODUCT
            SEL_SCR_007_INVENTORY --> SEL_SCR_023_VOUCHER
            SEL_SCR_007_INVENTORY --> SEL_SCR_025_REVIEW

            %% ===========================
            %% SELLER ORDER & REFUND
            %% ===========================
            subgraph SEL_MOD_ORDER [Seller: Order & Refund]
                direction TB
                SEL_SCR_009(SEL_SCR_009: Order List):::seller
                SEL_SCR_010(SEL_SCR_010: Order Details):::seller
                SEL_SCR_011(SEL_SCR_011: Order Processing):::seller
                SEL_SCR_026_RETURN(SEL_SCR_026: Return/Refund List):::seller
                SEL_SCR_027_RETURN(SEL_SCR_027: Return/Refund Details):::seller
            end

            SEL_ENTRY --> SEL_SCR_009
            SEL_SCR_009 --> SEL_SCR_010
            SEL_SCR_010 --> SEL_SCR_011
            SEL_SCR_010 -.-> SEL_SCR_026_RETURN
            SEL_SCR_026_RETURN --> SEL_SCR_027_RETURN

            %% ===========================
            %% SELLER NOTIFICATION
            %% ===========================
            subgraph SEL_MOD_NOTI [Seller: Notification]
                direction TB
                SEL_SCR_028_NOTI(SEL_SCR_028: Seller Notifications):::seller
                SEL_SCR_029_NOTI_SETTING(SEL_SCR_029: Notification Settings):::seller
            end

            SEL_ENTRY --> SEL_SCR_028_NOTI
            SEL_SCR_028_NOTI --> SEL_SCR_029_NOTI_SETTING

            %% ===========================
            %% SELLER SETTINGS
            %% ===========================
            subgraph SEL_MOD_SETTING [Seller: Settings]
                direction TB
                SEL_SCR_020_INCIDENT(SEL_SCR_020: Incident Report):::seller
                SEL_SCR_021_PROFILE(SEL_SCR_021: Seller Profile):::seller
                SEL_SCR_022_SHOP_SETTINGS(SEL_SCR_022: Shop Settings):::seller
            end

            SEL_ENTRY --> SEL_SCR_021_PROFILE
            SEL_SCR_021_PROFILE --> SEL_SCR_020_INCIDENT
            SEL_SCR_021_PROFILE --> SEL_SCR_022_SHOP_SETTINGS

            %% ===========================
            %% SELLER CHAT
            %% ===========================
            subgraph SEL_MOD_CHAT [Seller: Chat]
                direction TB
                SEL_SCR_025_CHAT(SEL_SCR_025: Seller Chat List):::seller
                SEL_SCR_026_CHAT(SEL_SCR_026: Seller Chat Detail):::seller
                SEL_SCR_027_CHAT(SEL_SCR_027: Chat From Product):::seller
            end

            SEL_ENTRY --> SEL_SCR_025_CHAT
            SEL_SCR_025_CHAT --> SEL_SCR_026_CHAT
            SEL_SCR_032_EDIT_PRODUCT -.-> SEL_SCR_027_CHAT

            %% ===========================
            %% SELLER WALLET
            %% ===========================
            subgraph SEL_MOD_WALLET [Seller: Wallet]
                direction TB
                SEL_SCR_030_WALLET(SEL_SCR_030: Seller Wallet Overview):::seller
                SEL_SCR_031_PAYOUT(SEL_SCR_031: Payout History):::seller
                SEL_SCR_032_WITHDRAW(SEL_SCR_032: Withdraw Request):::seller
            end

            SEL_ENTRY --> SEL_SCR_030_WALLET
            SEL_SCR_030_WALLET --> SEL_SCR_031_PAYOUT
            SEL_SCR_030_WALLET --> SEL_SCR_032_WITHDRAW
        end
    end

    %% ==========================================================
    %% APP 2: PARTNER APP (SHIPPER) - REMOVED
    %% Shipping is handled by external providers; no internal Shipper app.
    %% All SHP_SCR_* screens are out of scope and removed from this diagram.
    %% ==========================================================

    %% ==========================================================
    %% WEB ADMIN PORTAL
    %% ==========================================================
    subgraph WEB_ADMIN [WEB ADMIN PORTAL]
        direction TB
        ADM_SCR_001(ADM_SCR_001: Admin Login):::admin -->|Login Success| ADM_SCR_002(ADM_SCR_002: Admin Dashboard):::admin

        %% ===========================
        %% USER MANAGEMENT
        %% ===========================
        subgraph ADM_GRP_USER [User Management]
            direction LR
            ADM_SCR_003(ADM_SCR_003: User Management):::admin
            ADM_SCR_034(ADM_SCR_034: User Details):::admin
        end
        ADM_SCR_002 -->|Manage Users| ADM_GRP_USER
        ADM_SCR_003 -->|View User Details| ADM_SCR_034

        %% ===========================
        %% SELLER MANAGEMENT
        %% ===========================
        subgraph ADM_GRP_SELLER [Seller Management]
            direction LR
            ADM_SCR_004(ADM_SCR_004: Seller Management):::admin
            ADM_SCR_035(ADM_SCR_035: Seller Details):::admin
        end
        ADM_SCR_002 -->|Manage Sellers| ADM_GRP_SELLER
        ADM_SCR_004 -->|View Seller Details| ADM_SCR_035

        %% ===========================
        %% PRODUCT MANAGEMENT
        %% ===========================
        subgraph ADM_GRP_PROD [Product Management]
            direction LR
            ADM_SCR_005(ADM_SCR_005: Product Approval):::admin
            ADM_SCR_006(ADM_SCR_006: Product Management):::admin
        end
        ADM_SCR_002 -->|Manage Products| ADM_GRP_PROD
        ADM_SCR_005 -->|Approve & Manage| ADM_SCR_006

        %% ===========================
        %% ORDER MANAGEMENT
        %% ===========================
        subgraph ADM_GRP_ORDER [Order Management]
            direction LR
            ADM_SCR_007(ADM_SCR_007: Order Management):::admin
            ADM_SCR_008(ADM_SCR_008: Order Details):::admin
        end
        ADM_SCR_002 -->|Manage Orders| ADM_GRP_ORDER
        ADM_SCR_007 -->|View Order Details| ADM_SCR_008

        %% ===========================
        %% FINANCE
        %% ===========================
        subgraph ADM_GRP_FINANCE [Finance]
            direction LR
            ADM_SCR_010(ADM_SCR_010: Transaction Management):::admin
            ADM_SCR_011(ADM_SCR_011: Wallet Management):::admin
        end
        ADM_SCR_002 -->|Manage Finance| ADM_GRP_FINANCE
        ADM_SCR_010 -->|Manage Wallets| ADM_SCR_011

        %% ===========================
        %% DISPUTE MANAGEMENT
        %% ===========================
        subgraph ADM_GRP_DISPUTE [Dispute Management]
            direction LR
            ADM_SCR_028(ADM_SCR_028: Dispute List):::admin
            ADM_SCR_029(ADM_SCR_029: Dispute Details):::admin
            ADM_SCR_030(ADM_SCR_030: Dispute Resolution History):::admin
        end
        ADM_SCR_002 -->|Handle Disputes| ADM_GRP_DISPUTE
        ADM_SCR_028 -->|View Dispute Details| ADM_SCR_029
        ADM_SCR_029 -->|View Resolution History| ADM_SCR_030

        %% ===========================
        %% ANALYTICS
        %% ===========================
        ADM_SCR_019(ADM_SCR_019: Analytics Dashboard):::admin
        ADM_SCR_002 -->|View Analytics| ADM_SCR_019

        %% ===========================
        %% REVIEW MODERATION
        %% ===========================
        ADM_SCR_027(ADM_SCR_027: Review Moderation):::admin
        ADM_SCR_002 -->|Moderate Reviews| ADM_SCR_027

        %% ===========================
        %% PERMISSION & ADMIN SETTINGS
        %% ===========================
        subgraph ADM_GRP_ADMIN [Admin Settings]
            direction LR
            ADM_SCR_023(ADM_SCR_023: Role & Permission):::admin
            ADM_SCR_024(ADM_SCR_024: Admin Account):::admin
            ADM_SCR_025(ADM_SCR_025: Audit Log):::admin
        end
        ADM_SCR_002 -->|Admin Settings| ADM_GRP_ADMIN

        %% ===========================
        %% SYSTEM CONFIGURATION
        %% ===========================
        subgraph ADM_GRP_SYS [System Configuration]
            direction LR
            ADM_SCR_031(ADM_SCR_031: Platform Fee Settings):::admin
            ADM_SCR_032(ADM_SCR_032: Refund Policy Settings):::admin
            ADM_SCR_033(ADM_SCR_033: System Alert Thresholds):::admin
        end
        ADM_SCR_002 -->|System Configuration| ADM_GRP_SYS

        %% ===========================
        %% ENVIRONMENT (OUT OF SCOPE)
        %% ===========================
        subgraph ADM_GRP_ENV [Environment - Out of Scope]
            direction LR
            ADM_SCR_013(ADM_SCR_013: Review Tree Report):::common
            ADM_SCR_014(ADM_SCR_014: Real Tree Management):::common
            ADM_SCR_015(ADM_SCR_015: Tree Fund Management):::common
            ADM_SCR_016(ADM_SCR_016: Environment Report):::common
            ADM_SCR_017(ADM_SCR_017: Location Management):::common
        end
        ADM_SCR_002 -.->|Environment Optional| ADM_GRP_ENV
    end
    

    %% --- EXTERNAL SHIPPING PROVIDER (OUT OF SCOPE) ---
    EXT_SHIP["External Shipping Provider - Out of scope"]:::common

    %% --- CROSS CONNECTIONS ---
    %% Customer creates order -> Seller sees in Order List
    CUS_SCR_045 -.->|Order Created| SEL_SCR_009
    CUS_SCR_031 -.->|Order Details Viewed| SEL_SCR_009
     

    %% Return/Refund escalation
    CUS_SCR_046 -.->|Return/Refund Request| SEL_SCR_026_RETURN
    SEL_SCR_026_RETURN -.->|Escalate Dispute| ADM_SCR_028

    %% Seller -> External Shipping Provider -> Customer
    SEL_SCR_011 -.->|Hand over shipment| EXT_SHIP
    EXT_SHIP -.-> CUS_SCR_031
    